# Recommendations Service

## Оглавление
- [Описание проекта](#описание-проекта)
- [Описание алгоритма рекомендаций](#описание-алгоритма-рекомендаций)
- [Выбор алгоритма и ограничения решения](#выбор-алгоритма-и-ограничения-решения)
- [Возможные улучшения при росте нагрузки](#возможные-улучшения-при-росте-нагрузки)
- [Установка и запуск проекта](#установка-и-запуск-проекта)
- [Эндпоинты API](#эндпоинты-api)
  
## Описание проекта

Сервис рекомендаций товаров на основе пользовательских действий:
- кликов,
- добавлений в корзину,
- покупок.

Поддерживаются два сценария:
- рекомендации для существующих пользователей;
- рекомендации популярных товаров для новых пользователей.

Реализация выполнена на Python с использованием `FastAPI`.

---
## Описание алгоритма рекомендаций

Алгоритм рекомендаций основан на взвешенной оценке пользовательских действий.

### Используемые веса
- `click` — вес 1  
- `add_to_cart` — вес 2  
- `purchase` — вес 3  

### Рекомендации для существующего пользователя
1. Выбираются все события пользователя.
2. Исключаются товары, которые пользователь уже покупал.
3. Для каждого товара рассчитывается `interest_score`:
4. Товары группируются по `pid` и `brand`, баллы суммируются.
5. Результаты сортируются по убыванию `interest_score`.
6. Применяется ограничение:
   - не более 2 товаров одного бренда;
   - не более 5 товаров в выдаче.

### Рекомендации для нового пользователя
1. Для всех товаров рассчитывается `popularity_score`:
2. Товары группируются по `pid` и `brand`, баллы суммируются.
3. Результаты сортируются по убыванию `popularity_score`.
4. Применяется то же ограничение по брендам и количеству товаров.

## Выбор алгоритма и ограничения решения

Для решения задачи был выбран простой эвристический алгоритм рекомендаций
на основе взвешенных пользовательских действий.

Такой подход был выбран, поскольку он:
- прост в реализации и тестировании;
- прозрачен и легко интерпретируем;
- позволяет быстро управлять логикой рекомендаций через веса.

При этом алгоритм имеет ряд ограничений:
- используются фиксированные веса, не адаптирующиеся под пользователей;
- не учитывается временной фактор и персональные предпочтения;
- рекомендации новых товаров ограничены из-за отсутствия истории;
- решение не масштабируется без дополнительной оптимизации.

### Возможные улучшения алгоритма с учётом времени

- **Коэффициент затухания (decay):** можно уменьшать вес события с возрастом, чтобы старые действия влияли на рекомендации меньше.
  
  Пример формулы:  
   $weight = base\\_weight \cdot decay\\_factor^{days\\_since\\_event}$  
   Где `days_since_event = (today - date).days`, `0 < decay_factor < 1`. Чем старше действие, тем меньше его вклад в "интерес" пользователя.

- **Ограничение по окну времени:** можно учитывать только события за последние `N` дней (например, 30 дней), чтобы рекомендации отражали актуальные интересы пользователей и тренды.

---

## Возможные улучшения при росте нагрузки

- Хранение сырых событий в объектном хранилище (например, AWS S3).
- Использование базы данных для хранения агрегированных данных.
- Перенос агрегаций и сортировок на уровень базы данных.
- Кеширование популярных рекомендаций.
- Добавление более сложных алгоритмов рекомендаций.
- Выделение сервиса рекомендаций в отдельный API-сервис.

# Установка и запуск проекта

## Требования
- Python 3.11+ установлен и доступен в PATH  
- Docker и Docker Compose (для запуска контейнеров)  
---

## 1. Клонировать репозиторий

```bash
git clone git@github.com:EcLerk/product-recommendations-api.git
cd product-recommendations-api
```
### 2. Запуск проекта через Docker Compose

```bash
docker-compose up --build
```

## Эндпоинты API

- GET /api/recommendations/user_id=<uid> - получить рекомендации товаров для пользователя с `user_id=uid`

### Пример запроса

```bash
curl "http://127.0.0.1:8080/api/recommendations?user_id=144"
```
### Пример ответа

```bash
{
    "uid": 144,
    "products": [
        11557,
        10737,
        12108,
        12141,
        10272
    ]
}
```

> Swagger UI доступен по адресу: `http://127.0.0.1:8080/docs`  
